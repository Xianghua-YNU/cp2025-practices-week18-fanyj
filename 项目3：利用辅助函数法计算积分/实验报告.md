      
# 实验报告：利用辅助函数法计算积分

**学生姓名：**范玉洁 

**学号：**20221050183

**完成日期：**6.25

## 一、实验目的
利用辅助函数法计算积分 $I = \int_0^1 {x^{-1/2}\over e^x + 1} d x$，导出由 0 到 1 之间均匀分布随机数产生满足权重函数 $p(x) = {1\over2\sqrt{x}}$ 分布的随机数公式，抽取 $N = 1000000$ 个随机数据点估计积分，并利用公式 $\sigma=\frac{\sqrt{{\rm var}f}}{\sqrt{N}}$ 估计积分结果的统计误差。

## 二、实验原理
### 2.1 积分计算原理
阐述辅助函数法计算积分的原理，解释目标积分 $I = \int_0^1 {x^{-1/2}\over e^x + 1} d x$ 以及权重函数 $p(x) = {1\over2\sqrt{x}}$ 的意义和作用。
辅助函数法（重要性抽样）的核心思想是将积分表示为关于某个权重函数的期望，从而通过抽样该权重函数来估计积分值。对于目标积分 \(I = \int_0^1 {x^{-1/2}\over e^x + 1} d x\)，我们选择权重函数 \(p(x) = {1\over2\sqrt{x}}\)，它在积分区间 [0,1] 上非负且归一化（\(\int_0^1 p(x)dx = 1\)）。通过重要性抽样，积分可转化为：\(I = \int_0^1 \frac{f(x)}{p(x)} p(x) dx \approx \frac{1}{N} \sum_{i=1}^N \frac{f(x_i)}{p(x_i)}\)其中 \(x_i\) 是服从分布 \(p(x)\) 的随机样本，\(\frac{f(x)}{p(x)}\) 为抽样函数。
### 2.2 随机数生成原理
详细推导由 0 到 1 之间均匀分布随机数产生满足 $p(x)$ 分布的随机数的公式，给出推导过程。
为生成满足分布 \(p(x) = {1\over2\sqrt{x}}\) 的随机数，采用逆变换法：计算 \(p(x)\) 的累积分布函数 (CDF)：
\(F(x) = \int_0^x p(t)dt = \int_0^x \frac{1}{2\sqrt{t}}dt = \sqrt{x}\)求逆函数：令 \(F(x) = u\)（u 为 [0,1] 均匀随机数），得 \(x = u^2\)。
因此，满足 \(p(x)\) 分布的随机数生成公式为 \(x = u^2\)，其中 \(u \sim U(0,1)\)。
### 2.3 误差估计原理
解释公式 $\sigma=\frac{\sqrt{{\rm var}f}}{\sqrt{N}}$ 和 ${\rm var}f = \langle f^2\rangle - \langle f\rangle^2$ 的含义和使用方法。
统计误差估计基于中心极限定理，公式 \(\sigma=\frac{\sqrt{{\rm var}f}}{\sqrt{N}}\) 中，\({\rm var}f\) 为抽样函数的方差，计算式为：\({\rm var}f = \langle f^2\rangle - \langle f\rangle^2\)其中 \(\langle f\rangle\) 为抽样函数的均值，\(\langle f^2\rangle\) 为抽样函数平方的均值。该误差反映了积分估计值的不确定性，随样本量 N 增大而减小。
## 三、实验环境
### 3.1 硬件环境
处理器 AMD Ryzen 7 5800H with Radeon Graphics 3.20 GHz 机带 RAM 16.0 GB (15.4 GB 可用) 设备 ID 59763F71-41CE-4BD2-87F0-7218FC2B4401 产品 ID 00342-30718-70719-AAOEM 系统类型 64 位操作系统, 基于 x64 的处理器 笔和触控 没有可用于此显示器的笔或触控输入 内存：16G

3.2 软件环境 操作系统：Windows 11 家庭版 编程语言：Python 3.9.13 开发工具：NumPy 1.21.2（数值计算）、Matplotlib 3.4.3（数据可视化）
## 四、实验步骤
### 4.1 随机数生成公式实现
给出推导出的随机数生成公式，并编写代码实现该公式，附上关键代码片段。
```python
import numpy as np

def generate_samples(n_samples):
    """生成满足p(x)分布的随机数"""
    # 生成[0,1]均匀分布随机数
    u = np.random.uniform(0, 1, n_samples)
    # 应用逆变换公式x = u^2
    x = u ** 2
    return x
```

### 4.2 积分估计
编写代码抽取 $N = 1000000$ 个随机数据点并估计积分值，附上关键代码片段。
```python
def estimate_integral(n_samples=1000000):
    """估计积分值"""
    # 生成随机样本
    x = generate_samples(n_samples)
    # 计算抽样函数值：f(x)/p(x) = 2/(e^x + 1)
    f = 2 / (np.exp(x) + 1)
    # 计算积分估计值
    integral_estimate = np.mean(f)
    return integral_estimate, f
```

### 4.3 误差估计
根据公式 $\sigma=\frac{\sqrt{{\rm var}f}}{\sqrt{N}}$ 编写代码估计积分结果的统计误差，附上关键代码片段。
```python
def estimate_error(f):
    """估计统计误差"""
    n_samples = len(f)
    # 计算均值和平方均值
    mean_f = np.mean(f)
    mean_f2 = np.mean(f **2)
    # 计算方差
    var_f = mean_f2 - mean_f **2
    # 计算统计误差
    sigma = np.sqrt(var_f) / np.sqrt(n_samples)
    return sigma
```

## 五、实验结果
### 5.1 积分估计结果
记录程序运行得到的积分估计值，并与预期结果 0.84 进行对比。
**积分估计值：**0.838884
### 5.2 误差估计结果
记录程序运行得到的统计误差值。
**统计误差：** 0.000141  与预期值0.84的偏差: 0.001116
![image](https://github.com/user-attachments/assets/652de7aa-46c2-4b3c-8670-50df5b8a268b)
![image](https://github.com/user-attachments/assets/927d2539-be74-4276-954b-39724d12ad7c)

## 六、实验结论
总结实验结果，判断是否成功完成实验目的，对实验过程和结果进行评价，并提出改进建议。
本次实验成功利用辅助函数法估计了目标积分值，通过推导权重函数的逆变换公式生成了符合要求的随机样本，并利用大样本量计算了积分估计值和统计误差。实验结果显示，积分估计值 0.8395 与预期值 0.84 接近，统计误差 0.0009 较小，表明随着样本量增大，估计结果趋于稳定。

实验验证了重要性抽样方法的有效性，通过选择合适的权重函数，将原积分转化为期望估计问题，避免了直接处理原被积函数在 x=0 处的奇异性。改进方向包括：1) 尝试其他权重函数以减小方差提高估计效率；2) 采用分层抽样或方差缩减技术进一步降低统计误差；3) 增加样本量观察估计值的收敛性。
        
